# Ansible managed

# Ubuntu upstart file at /etc/init/mongod.conf

# Recommended ulimit values for mongod or mongos
# See http://docs.mongodb.org/manual/reference/ulimit/#recommended-settings
#
limit fsize unlimited unlimited
limit cpu unlimited unlimited
limit as unlimited unlimited
limit nofile 64000 64000
limit rss unlimited unlimited
limit nproc 32000 32000

kill timeout 300 # wait 300s between SIGTERM and SIGKILL.

pre-start script
    mkdir -p /opt/welder
    mkdir -p {{project_folder}}
    mkdir -p {{upload_folder}}
end script

start on runlevel [2345]
stop on runlevel [06]

script
  ENABLE_WELDER="yes"
  DIR=/opt/welder
{% if use_tls %}
  DAEMON_OPTS="/opt/welder/welder.js TLS"
{% else %}
  DAEMON_OPTS="/opt/welder/welder.js default"
{% endif %}
  DAEMON=/usr/local/bin/node

  if [ "x$ENABLE_WELDER" = "xyes" ]
  then
    cd $DIR; exec start-stop-daemon --start --exec $DAEMON $DAEMON_OPTS
  fi
end script